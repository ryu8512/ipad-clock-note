<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>시계 + 메모</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: row;
      height: 100vh;
      background-color: black;
      color: white;
      font-family: Orbitron, sans-serif;
    }

    #clock {
      flex: 7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10vw;
    }

    #memo-section {
      flex: 3;
      display: flex;
      flex-direction: column;
      border-left: 2px solid #444;
    }

    #toolbar {
      display: flex;
      gap: 10px;
      padding: 10px;
      background-color: #222;
      align-items: center;
    }

    #memo {
      flex: 1;
      padding: 15px;
      outline: none;
      overflow-y: auto;
      font-family: Arial, sans-serif;
      line-height: 1.4;
      word-wrap: break-word;
    }

    button, select {
      background-color: #444;
      color: white;
      border: none;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
    }

    button.active {
      background-color: #666;
    }

    #resetStyle {
      background-color: #880000;
    }

    ::selection {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>
  <div id="clock"></div>

  <div id="memo-section">
    <div id="toolbar">
      <button id="fontSizeIncrease">A▲</button>
      <button id="fontSizeDecrease">A▼</button>
      <select id="colorPicker">
        <option value="white">White</option>
        <option value="red">Red</option>
        <option value="yellow">Yellow</option>
        <option value="skyblue">Skyblue</option>
        <option value="lime">Lime</option>
      </select>
      <button id="boldButton">B</button>
      <button id="resetStyle">Reset</button>
    </div>
    <div id="memo" contenteditable="true"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // 시계 표시
    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleTimeString("ko-KR", { hour12: false });
      document.getElementById("clock").textContent = timeString;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyD_46mrsyHrDmf_GCz4rjQSHmkjU3cnIEI",
      authDomain: "ipad-clock-memo.firebaseapp.com",
      databaseURL: "https://ipad-clock-memo-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ipad-clock-memo",
      storageBucket: "ipad-clock-memo.appspot.com",
      messagingSenderId: "54923892654",
      appId: "1:54923892654:web:ac3f712f18245490885a3f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const memoRef = db.ref("memo");

    const memo = document.getElementById("memo");
    const fontSizeIncrease = document.getElementById("fontSizeIncrease");
    const fontSizeDecrease = document.getElementById("fontSizeDecrease");
    const colorSelect = document.getElementById("colorPicker");
    const boldButton = document.getElementById("boldButton");
    const resetButton = document.getElementById("resetStyle");

    // 기본 폰트 크기 감지 및 설정
    let defaultFontSize = 40;
    const ua = navigator.userAgent.toLowerCase();
    const isIPhone = /iphone/.test(ua);
    const isIPad = /ipad/.test(ua) || (/macintosh/.test(ua) && 'ontouchend' in document);
    const isGalaxyTab = /samsung/.test(ua) && /sm-t733/.test(ua);
    const isWindows = navigator.platform.startsWith("Win");

    if (isIPhone) defaultFontSize = 14;
    else if (isIPad || isGalaxyTab || isWindows) defaultFontSize = 40;

    // 메모 초기 폰트 크기 적용
    memo.style.fontSize = defaultFontSize + "px";

    // 메모 저장
    function saveMemo() {
      memoRef.set(memo.innerHTML);
      localStorage.setItem("memo", memo.innerHTML);
    }

    // 메모 불러오기
    memoRef.on("value", (snapshot) => {
      const value = snapshot.val();
      if (value !== null) {
        memo.innerHTML = value;
        memo.style.fontSize = defaultFontSize + "px"; // 강제 적용
      }
    });

    // 입력 이벤트
    memo.addEventListener("input", saveMemo);

    // 폰트 크기 변경
    function changeFontSize(delta) {
      let selection = window.getSelection();
      if (selection.rangeCount && !selection.isCollapsed) {
        applyStyleToSelection(span => {
          const current = parseInt(getComputedStyle(span).fontSize) || defaultFontSize;
          span.style.fontSize = (current + delta) + "px";
        });
      } else {
        let currentSize = parseInt(getComputedStyle(memo).fontSize);
        let newSize = currentSize + delta;
        memo.style.fontSize = newSize + "px";
      }
      saveMemo();
    }

    fontSizeIncrease.addEventListener("click", () => changeFontSize(1));
    fontSizeDecrease.addEventListener("click", () => changeFontSize(-1));

    // 선택 영역 스타일 적용 함수
    function applyStyleToSelection(styleCallback) {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      const range = selection.getRangeAt(0);
      if (range.collapsed) return;

      const span = document.createElement("span");
      span.appendChild(range.extractContents());
      styleCallback(span);
      range.insertNode(span);

      // 커서를 span 뒤로 이동
      const newRange = document.createRange();
      newRange.setStartAfter(span);
      newRange.collapse(true);
      selection.removeAllRanges();
      selection.addRange(newRange);

      saveMemo();
    }

    // 색상 적용
    colorSelect.addEventListener("change", () => {
      applyStyleToSelection(span => {
        span.style.color = colorSelect.value;
      });
    });

    // 굵기 토글
    boldButton.addEventListener("click", () => {
      boldButton.classList.toggle("active");
      applyStyleToSelection(span => {
        span.style.fontWeight = boldButton.classList.contains("active") ? "bold" : "normal";
      });
    });

    // 스타일 초기화
    resetButton.addEventListener("click", () => {
      applyStyleToSelection(span => {
        span.style.fontSize = "";
        span.style.color = "";
        span.style.fontWeight = "";
      });
      boldButton.classList.remove("active");
      colorSelect.value = "white";
    });
  </script>
</body>
</html>
