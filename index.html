<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clock + Memo</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ClockMemo">
  <style>
    :root {
      --clock-font-size: 20vw;
      --seconds-font-size: 2vw;
      --date-font-size: 4vw;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background-color: black; color: white;
      font-family: 'Orbitron', sans-serif;
    }
    body { display: flex; flex-direction: row; }
    #refresh-button {
      position: absolute; top: 20px; left: 20px;
      font-size: 2rem; background: transparent; color: white;
      border: none; padding: 5px 10px; cursor: pointer; z-index: 1000;
    }
    #clock-container {
      flex: 7; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      border-right: 1px solid #333; overflow: hidden;
    }
    #date { font-size: var(--date-font-size); margin-bottom: 20px; text-align: center; }
    #time {
      font-size: var(--clock-font-size);
      font-variant-numeric: tabular-nums; line-height: 1;
    }
    #seconds {
      font-size: var(--seconds-font-size);
      margin-top: 10px; font-variant-numeric: tabular-nums;
      align-self: flex-end; margin-right: 80px;
    }
    #memo-container { flex: 3; padding: 10px; }
    #memo {
      font-family: Arial, sans-serif;
      width: 100%; height: 100%; font-size: 1.2vw;
      background-color: #111; color: white;
      border: none; resize: none; outline: none;
      padding: 10px; line-height: 1.5;
    }
    .toolbar {
      display: flex; justify-content: center;
      margin-bottom: 10px; gap: 10px; flex-wrap: wrap;
    }
    .toolbar select, .toolbar button {
      background: none; color: white;
      border: none; padding: 5px 8px;
      font-size: 1.2rem; font-weight: bold; cursor: pointer;
    }
    .toolbar button.active {
      background-color: white; color: black; border-radius: 4px;
    }
    .toolbar select option {
      background-color: black; color: white;
    }
    @media screen and (orientation: portrait) {
      body { flex-direction: column; }
      #clock-container {
        flex: none; height: 20%;
        border-right: none; border-bottom: 1px solid #333;
      }
      #memo-container { flex: none; height: 80%; }
      #date { font-size: 4vw; }
      #time { font-size: 12vw; }
      #seconds { display: none; }
      #memo { font-size: 4vw; }
      .toolbar select, .toolbar button {
        font-size: 4vw; padding: 10px 0;
      }
    }
  </style>
</head>
<body>
  <button id="refresh-button" onclick="location.reload()">⟳</button>

  <div id="clock-container">
    <div id="date"></div>
    <div id="time"></div>
    <div id="seconds"></div>
  </div>

  <div id="memo-container">
    <div class="toolbar">
      <select id="fontSize">
        <option value="9">Font 9px</option>
        <option value="10">Font 10px</option>
        <option value="11">Font 11px</option>
        <option value="12">Font 12px</option>
        <option value="13">Font 13px</option>
        <option value="14">Font 14px</option>
        <option value="15">Font 15px</option>
        <option value="16">Font 16px</option>
        <option value="17">Font 17px</option>
        <option value="18">Font 18px</option>
        <option value="19">Font 19px</option>
        <option value="20">Font 20px</option>
      </select>
      <select id="colorPicker">
        <option value="white">White</option>
        <option value="red">Red</option>
        <option value="blue">Blue</option>
        <option value="green">Green</option>
        <option value="yellow">Yellow</option>
      </select>
      <button id="boldButton">B</button>
    </div>
    <div id="memo" contenteditable="true" placeholder="메모를 입력하세요..."></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD_46mrsyHrDmf_GCz4rjQSHmkjU3cnIEI",
      authDomain: "ipad-clock-memo.firebaseapp.com",
      databaseURL: "https://ipad-clock-memo-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ipad-clock-memo",
      storageBucket: "ipad-clock-memo.appspot.com",
      messagingSenderId: "54923892654",
      appId: "1:54923892654:web:ac3f712f18245490885a3f",
      measurementId: "G-Y8C288823S"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const memoRef = db.ref("memo");

    function updateClock() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const date = String(now.getDate()).padStart(2, '0');
      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const day = dayNames[now.getDay()];
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');

      document.getElementById('date').textContent = `${year}.${month}.${date}.${day}`;
      document.getElementById('time').textContent = `${hours}:${minutes}`;
      document.getElementById('seconds').textContent = seconds;
    }
    setInterval(updateClock, 1000);
    updateClock();

    const memo = document.getElementById('memo');

    memoRef.on('value', (snapshot) => {
      const value = snapshot.val();
      if (value !== null && value !== memo.innerHTML) {
        memo.innerHTML = value;
      }
    });

    memo.addEventListener('input', () => {
      const content = memo.innerHTML;
      localStorage.setItem('memo', content);
      memoRef.set(content);
    });

    // 글자 크기 설정 (정확한 px 적용)
    document.getElementById('fontSize').addEventListener('change', (e) => {
      const size = e.target.value + 'px';
      const selection = window.getSelection();
      if (!selection.rangeCount) return;

      const range = selection.getRangeAt(0);
      const span = document.createElement('span');
      span.style.fontSize = size;
      span.appendChild(range.extractContents());
      range.insertNode(span);

      // 커서를 span 바깥으로 이동
      selection.removeAllRanges();
      const newRange = document.createRange();
      newRange.selectNodeContents(span);
      newRange.collapse(false);
      selection.addRange(newRange);
    });

    // 볼드 버튼
    const boldButton = document.getElementById('boldButton');
    boldButton.addEventListener('click', () => {
      document.execCommand('bold');
      const isBold = document.queryCommandState('bold');
      boldButton.classList.toggle('active', isBold);
    });

    // 글자 색상
    document.getElementById('colorPicker').addEventListener('change', (e) => {
      document.execCommand('foreColor', false, e.target.value);
    });
  </script>
</body>
</html>
